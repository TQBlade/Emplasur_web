<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard | EMPLANORTE S.A.S</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <link rel="stylesheet" href="css/inventario.css">
</head>
<body>

<div class="bg-shape bg-s1"></div>
<div class="bg-shape bg-s2"></div>
<div class="bg-shape bg-s3"></div>

<div class="dashboard">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="brand">
      <img src="./img/Circulo.png" alt="logo" class="brand-logo">
      <strong>EMPLANORTE</strong>
    </div>
    <ul class="nav" id="sideNav">
      <li><a href="#" class="active" data-tab="inventory"><i class="fa-solid fa-warehouse"></i>Inventario</a></li>
      <li><a href="#" data-tab="sales"><i class="fa-solid fa-receipt"></i>Ventas</a></li>
      <li><a href="#" data-tab="products"><i class="fa-solid fa-box-open"></i>Productos</a></li>
    </ul>

    <div class="userbar">
      <div class="userinfo">
        <i class="fa-solid fa-circle-user"></i>
        <span>Usuario<br><small style="color:#9fb0cc">Administrador</small></span>
      </div>
      <button class="logout" title="Salir" id="btnLogout">
        <i class="fa-solid fa-right-from-bracket"></i>
      </button>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <div class="topbar">
      <a class="back-home" href="/">
        <i class="fa-solid fa-arrow-left"></i> Volver al inicio
      </a>
    </div>

    <!-- KPIs -->
    <section class="kpis">
      <div class="kpi">
        <div class="ico"><i class="fa-solid fa-boxes-stacked"></i></div>
        <div>
          <div class="label">Productos Totales</div>
          <div class="num" id="kpiProducts">0</div>
        </div>
      </div>
      <div class="kpi">
        <div class="ico"><i class="fa-solid fa-dollar-sign"></i></div>
        <div>
          <div class="label">Ventas del día</div>
          <div class="num" id="kpiSales">0</div>
        </div>
      </div>
      <div class="kpi">
        <div class="ico"><i class="fa-solid fa-wallet"></i></div>
        <div>
          <div class="label">Ingresos del día</div>
          <div class="num" id="kpiRevenue">$0</div>
        </div>
      </div>
      <div class="kpi">
        <div class="ico"><i class="fa-solid fa-triangle-exclamation"></i></div>
        <div>
          <div class="label">Alertas de Stock</div>
          <div class="num" id="kpiAlerts">0</div>
        </div>
      </div>
    </section>

    <!-- ================= INVENTARIO ================= -->
    <section class="section" id="inventorySection">
      <div class="card">
        <div class="section-hd">
          <div style="font-weight:800"><i class="fa-solid fa-boxes-stacked"></i> Inventario Actual</div>
          <div class="search">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input id="invSearch" placeholder="Buscar por código o nombre...">
          </div>
        </div>

        <div class="table-wrap">
          <table id="invTable">
            <thead>
              <tr>
                <th>Categoría</th>
                <th>Código</th>
                <th>Producto</th>
                <th>Lotes (pacas)</th>
                <th>Total pacas</th>
                <th>Total unidades</th>
                <th>Mínimo (u)</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="invBody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- ================= VENTAS ================= -->
    <section class="section" id="salesSection" style="display:none">
      <div class="card">
        <div class="section-hd">
          <div style="font-weight:800"><i class="fa-solid fa-receipt"></i> Ventas</div>
          <div style="display:flex;gap:8px">
            <button class="btn-primary" id="btnTabSaleForm">Registrar venta</button>
            <button class="btn-secondary" id="btnTabSaleHistory">Historial de ventas</button>
          </div>
        </div>

        <!-- ===== VENTAS DE HOY (SOLO TABLA) ===== -->
        <div id="saleFormSection">
          <div class="card" style="margin:0 18px 18px">
            <div class="section-hd small-hd">
              <div><i class="fa-solid fa-list"></i> Ventas de hoy</div>
            </div>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>Fecha</th>
                    <th>Producto</th>
                    <th>Detalle</th>
                    <th>Cant. (u)</th>
                    <th>Total venta</th>
                    <th>Costo total</th>
                    <th>Ganancia</th>
                    <th>Cliente</th>
                  </tr>
                </thead>
                <tbody id="salesTodayBody"></tbody>
              </table>
            </div>
            <div class="sales-summary-grid">
              <div class="summary-card">
                <span class="summary-label">Total ventas del día</span>
                <span class="summary-value" id="sumVentasDia">$0</span>
              </div>
              <div class="summary-card">
                <span class="summary-label">Costo total del día</span>
                <span class="summary-value" id="sumCostoDia">$0</span>
              </div>
              <div class="summary-card">
                <span class="summary-label">Ganancia total del día</span>
                <span class="summary-value" id="sumGananciaDia">$0</span>
              </div>
            </div>
          </div>
        </div>

        <!-- ===== SUBSECCIÓN: HISTORIAL COMPLETO ===== -->
        <div id="saleHistorySection" style="display:none">
          <div class="form" style="padding-bottom:0">
            <div class="row">
              <div>
                <div class="label">Desde</div>
                <input class="input" type="date" id="f_desde">
              </div>
              <div>
                <div class="label">Hasta</div>
                <input class="input" type="date" id="f_hasta">
              </div>
            </div>
            <div style="margin-top:12px; display:flex; gap:10px; justify-content:flex-end">
              <button class="btn-secondary" id="btnFiltrarVentas">Filtrar</button>
              <button class="btn-primary" id="btnPDFVentas">
                <i class="fa-solid fa-file-pdf"></i> Generar PDF
              </button>
            </div>
          </div>

          <div class="card" style="margin:0 18px 18px">
            <div class="section-hd">
              <div style="font-weight:800"><i class="fa-solid fa-table"></i> Historial completo de ventas</div>
            </div>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>Fecha</th>
                    <th>Producto</th>
                    <th>Detalle</th>
                    <th>Cant. (u)</th>
                    <th>Total venta</th>
                    <th>Costo total</th>
                    <th>Ganancia</th>
                    <th>Cliente</th>
                  </tr>
                </thead>
                <tbody id="salesHistoryBody"></tbody>
              </table>
            </div>

            <div class="sales-summary-grid">
              <div class="summary-card">
                <span class="summary-label">Total ventas filtradas</span>
                <span class="summary-value" id="t_total">$0</span>
              </div>
              <div class="summary-card">
                <span class="summary-label">Total costo filtrado</span>
                <span class="summary-value" id="t_costo">$0</span>
              </div>
              <div class="summary-card">
                <span class="summary-label">Ganancia total</span>
                <span class="summary-value" id="t_ganancia">$0</span>
              </div>
            </div>

          </div>
        </div>

      </div>
    </section>

    <!-- ================= PRODUCTOS ================= -->
    <section class="section" id="productsSection" style="display:none">
      <div class="card">
        <div class="section-hd">
          <div style="font-weight:800"><i class="fa-solid fa-box-open"></i> Productos</div>
          <div>
            <button id="btnAddProductTop" class="btn-primary">
              <i class="fa-solid fa-plus"></i> Añadir Producto
            </button>
          </div>
        </div>

        <div class="table-wrap">
          <table id="prdTable">
            <thead>
              <tr>
                <th>Código</th>
                <th>Producto</th>
                <th>Categoría</th>
                <th>Costo unit.</th>
                <th>Precio unit.</th>
                <th>Mínimo (u)</th>
                <th>Total unidades</th>
              </tr>
            </thead>
            <tbody id="prdBody"></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>
</div>

<!-- ========= MODAL REGISTRAR VENTA ========= -->
<div class="modal-backdrop" id="saleModal" style="display:none">
  <div class="modal">
    <div class="modal-hd">
      <strong><i class="fa-solid fa-receipt"></i> Registrar venta</strong>
      <button class="close" data-close="saleModal"><i class="fa-solid fa-xmark"></i></button>
    </div>
    <div class="modal-bd">
      <form class="form" id="saleForm">
        <div class="label">Producto</div>
        <select class="select" id="saleProduct"></select>

        <div style="margin:12px 0 6px" class="label">Modo de venta</div>
        <div class="pill-toggle" id="saleMode">
          <button type="button" data-mode="unit" class="active">Unidades</button>
          <button type="button" data-mode="pack">Pacas</button>
          <button type="button" data-mode="mixed">Mixto</button>
        </div>

        <!-- UNIDADES -->
        <div id="saleUnitsBox" style="margin-top:12px">
          <div class="label">Cantidad (unidades)</div>
          <input class="input" type="number" id="saleUnits" min="1" value="1">
        </div>

        <!-- PACAS -->
        <div id="salePacksBox" style="display:none; margin-top:12px">
          <div class="row">
            <div>
              <div class="label">Tamaño de paca (u)</div>
              <select class="select" id="salePackSize"></select>
            </div>
            <div>
              <div class="label">Cantidad de pacas</div>
              <input class="input" type="number" id="salePackQty" min="1" value="1">
            </div>
          </div>
        </div>

        <!-- MIXTO: PACAS + UNIDADES SUELTAS -->
        <div id="saleMixedBox" style="display:none; margin-top:12px">
          <div class="row">
            <div>
              <div class="label">Tamaño de paca (u)</div>
              <select class="select" id="salePackSizeMixed"></select>
            </div>
            <div>
              <div class="label">Cantidad de pacas</div>
              <input class="input" type="number" id="salePackQtyMixed" min="0" value="0">
            </div>
          </div>
          <div style="margin-top:12px">
            <div class="label">Unidades sueltas</div>
            <input class="input" type="number" id="saleUnitsMixed" min="0" value="0">
          </div>
        </div>

        <div style="margin-top:12px">
          <div class="label">Precio unitario de venta</div>
          <input class="input" type="number" id="salePrice" min="0" value="0">
          <div class="helper">
            Por defecto toma el precio unitario del producto, puedes modificarlo.
          </div>
        </div>

        <div style="margin-top:12px">
          <div class="label">Cliente (opcional)</div>
          <input class="input" id="saleClient" placeholder="Nombre del cliente">
        </div>

        <div style="margin-top:16px; display:flex; justify-content:flex-end; gap:10px">
          <button type="button" class="btn-primary" style="background:#263752;color:#d7e4ff" data-close="saleModal">
            <i class="fa-solid fa-circle-xmark"></i> Cancelar
          </button>
          <button class="btn-primary" type="submit">
            <i class="fa-solid fa-floppy-disk"></i> Registrar venta
          </button>
        </div>
        <div class="helper" style="margin-top:10px">
          La rebaja se hace por <b>FIFO</b>: primero unidades sueltas y luego pacas de los lotes más antiguos.
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ========= MODAL NUEVO / EDITAR PRODUCTO ========= -->
<div class="modal-backdrop" id="productModal" style="display:none">
  <div class="modal">
    <div class="modal-hd">
      <strong><i class="fa-solid fa-plus"></i> Producto</strong>
      <button class="close" data-close="productModal"><i class="fa-solid fa-xmark"></i></button>
    </div>
    <div class="modal-bd">
      <form id="newProductForm">
        <div class="form">
          <div class="row">
            <div>
              <div class="label">Código</div>
              <input class="input" id="p_code" placeholder="P-000">
            </div>
            <div>
              <div class="label">Nombre</div>
              <input class="input" id="p_name" placeholder="Nombre del producto">
            </div>
          </div>
          <div class="row">
            <div>
              <div class="label">Costo unit.</div>
              <input class="input" id="p_cost" type="number" step="0.01" value="0">
            </div>
            <div>
              <div class="label">Precio unit.</div>
              <input class="input" id="p_price" type="number" step="0.01" value="0">
            </div>
          </div>
          <div class="row">
            <div>
              <div class="label">Categoría</div>
              <input class="input" id="p_cat" placeholder="Categoría">
            </div>
            <div>
              <div class="label">Stock mínimo (u)</div>
              <input class="input" id="p_min" type="number" value="0">
            </div>
          </div>

          <div class="card" style="margin-top:12px">
            <div class="section-hd">
              <div><i class="fa-solid fa-layer-group"></i> Pacas</div>
            </div>
            <div class="form">
              <div class="row">
                <div>
                  <div class="label">Paca de (u)</div>
                  <input class="input" id="pack_size" type="number" value="0">
                </div>
                <div>
                  <div class="label">Cantidad pacas</div>
                  <input class="input" id="pack_qty" type="number" value="0" min="0">
                </div>
              </div>

              <button type="button" id="btnAddPackRow" class="btn-primary" style="margin-top:10px">
                <i class="fa-solid fa-plus"></i> Agregar fila de paca
              </button>

              <div id="packRows" style="margin-top:10px"></div>

              <div class="row" style="margin-top:12px">
                <div>
                  <div class="label">Unidades sueltas</div>
                  <input class="input" id="loose_units" type="number" value="0" min="0">
                </div>
                <div>
                  <div class="label">Total (solo lectura)</div>
                  <input class="input" id="total_preview" type="number" value="0" readonly>
                </div>
              </div>
              <div class="helper">
                El total se calcula: (pacas × tamaño) + sueltas.
              </div>
            </div>
          </div>

          <div style="display:flex;gap:10px;justify-content:flex-end">
            <button type="button" class="btn-primary" style="background:#263752;color:#d7e4ff" data-close="productModal">
              <i class="fa-solid fa-circle-xmark"></i> Cancelar
            </button>
            <button class="btn-primary" type="submit">
              <i class="fa-solid fa-floppy-disk"></i> Guardar
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- =============== SCRIPTS =============== -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="js/app.js"></script>
<script src="js/inventario.js"></script>
<script src="js/productos.js"></script>
<script src="js/ventas.js"></script>

</body>
</html>
